
@{
    ViewBag.Title = "ChangePassword";
    Layout = "~/Areas/AdminArea/Views/Shared/_LayoutAdmin.cshtml";
}

<h3 style="color: purple; text-align: center">Change Password</h3>

<div class="row" style="margin:auto;">
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
        <div class="col-lg-12">
            <div class="form-group">
                <label for="old-pass">Old Password</label>
                <input style="width:400px;" class="form-control" type="password" id="CurrentPassword" name="CurrentPassword" required />
                <span id="check_current_pass_id" style="display:none;color:red;">Password must have 8-50 characters!</span>
                <span id="check_current_pass_match_id" style="display:none;color:red;">Password is not right!</span>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="form-group">
                <label for="new-pass">New Password</label>
                <input class="form-control" type="password" id="NewPassword" name="NewPassword" required />
                <span id="check_new_pass_id" style="display:none;color:red;">Password must have 8-50 characters!</span>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="form-group">
                <label for="confirm-pass">Confirm Password</label>
                <input class="form-control" type="password" id="ConfirmPassword" name="ConfirmPassword" required />
                <span id="check_confirm_pass_id" style="display:none;color:red;">Password must have 8-50 characters!</span>
                <span id="WrongPass" name="WrongPass" style="display:none;color:red;">New password and confirm password are not the same!</span>
            </div>
        </div>
        <div class="col-12">
            <hr class="mt-2 mb-3">
            <div class="d-flex flex-wrap justify-content-between align-items-center">
                <button class="btn btn-primary" id="SubmitForm" type="submit">Update Password</button>
            </div>
        </div>
    }

</div>
<div>
    <a href="@Url.Action("AdminInformation", "Admin" , new { Area="AdminArea" })">
        Back to my Information
    </a>
</div>

@section scripts {
    <script type="text/javascript">

        $(document).ready(function () {
            var pass = "";
            var confirmPass = "";
            var regPass = new RegExp(".{8,50}");
            var curPassMatch = false;
            var curPassFormat = false;
            var newPassFormat = false;
            var conPassMatch = false;

            $("#CurrentPassword").keyup(function () {
                if (regPass.test($(this).val()) == false) {
                    $("#check_current_pass_id").css("display", "block");
                    $("#check_current_pass_match_id").css("display", "none");
                    curPassFormat = false;
                    $("#SubmitForm").attr("disabled", true);                   
                }
                else {
                    $("#check_current_pass_id").css("display", "none");                    
                    curPassFormat = true;
                    if (curPassMatch && curPassFormat && newPassFormat && conPassMatch) {
                        $("#SubmitForm").attr("disabled", false);
                    }
                    $.ajax({
                        url: 'CheckCurrentPassword',
                        method: "post",
                        data: {
                            //change dynamic id
                            //id: 1,
                            password: $(this).val()
                        },
                        success: function (response) {
                            if (response == 1) {
                                $("#check_current_pass_match_id").css("display", "none");
                                curPassMatch = true;
                                if (curPassMatch && curPassFormat && newPassFormat && conPassMatch) {
                                    $("#SubmitForm").attr("disabled", false);
                                }
                            }
                            else {
                                $("#check_current_pass_match_id").css("display", "block");
                                curPassMatch = false;
                                $("#SubmitForm").attr("disabled", true);
                            }
                        }
                    });
                }
            });

            $("#NewPassword").keyup(function () {
                if (regPass.test($(this).val()) == false) {
                    $("#check_new_pass_id").css("display", "block");
                    newPassFormat = false;
                    $("#SubmitForm").attr("disabled", true);                }
                else {
                    $("#check_new_pass_id").css("display", "none");                    
                    newPassFormat = true;
                    if (curPassMatch && curPassFormat && newPassFormat && conPassMatch) {
                        $("#SubmitForm").attr("disabled", false);
                    }
                }

                if ($(this).val() != confirmPass) {
                    $("#WrongPass").css("display", "block");
                    conPassMatch = false;
                    $("#SubmitForm").attr("disabled", true);
                }
                else {
                    $("#WrongPass").css("display", "none");
                    conPassMatch = true;
                    if (curPassMatch && curPassFormat && newPassFormat && conPassMatch) {
                        $("#SubmitForm").attr("disabled", false);
                    }
                }
                pass = $(this).val();
            });

            $("#ConfirmPassword").keyup(function () {
                if ($(this).val() != pass) {
                    $("#WrongPass").css("display", "block");
                    conPassMatch = false;
                    $("#SubmitForm").attr("disabled", true);                   
                }
                else {
                    $("#WrongPass").css("display", "none");
                    conPassMatch = true;
                    if (curPassMatch && curPassFormat && newPassFormat && conPassMatch) {
                        $("#SubmitForm").attr("disabled", false);
                    }
                }
                confirmPass = $(this).val();
            });
        });

    </script>
}
